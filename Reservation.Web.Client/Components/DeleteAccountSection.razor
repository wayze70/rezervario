@inject ISnackbar Snackbar
@inject IAccountService AccountService
@inject NavigationManager NavigationManager

<MudExpansionPanel Text="Zrušení účtu" Class="mt-5">
    <EditForm Model="@DeleteRequest" OnValidSubmit="OnDeleteAccountValidSubmit">
        <EmailInput Variant="Variant.Text" Adornment="Adornment.None" @bind-Value="DeleteRequest.Email"/>
        <MudTextField T="string" Label="Heslo" @bind-Value="DeleteRequest.Password"
                      Required="true" InputType="InputType.Password"/>
        <MudButton ButtonType="ButtonType.Submit" Color="Color.Error"
                   Variant="Variant.Filled" Class="mt-4">
            Smazat účet
        </MudButton>
    </EditForm>
</MudExpansionPanel>

@code {
    public DeleteAccountRequest DeleteRequest { get; set; } = new();

    private async Task OnDeleteAccountValidSubmit()
    {
        var result = await AccountService.DeleteAccount(DeleteRequest);

        if (result.IsSuccess)
        {
            Snackbar.Add("Účet byl úspěšně smazán.", Severity.Success);
            NavigationManager.NavigateTo("/");
        }
        else
        {
            Snackbar.Add("Nepodařilo se smazat účet. Zkontrolujte své údaje.", Severity.Error);
        }
    }
}